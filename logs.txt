torch>=2.0.0
torchvision>=0.15.0
transformers>=4.40.0
timm>=0.9.0
scikit-learn>=1.2.0
pandas>=2.0.0
tqdm>=4.65.0
Pillow>=10.0.0
requests>=2.31.0
import os
import torch
import torch.nn as nn
import torch.optim as optim
from torch.utils.data import DataLoader
from torchvision import transforms
from dataset import BrainMRIDataset
from hybrid import HybridModel  # Import your hybrid model here
from sklearn.model_selection import train_test_split
from tqdm import tqdm
from transformers import ViTImageProcessor
from PIL import Image

device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')

DATA_DIR = r'dataset\Processed'
METADATA_CSV = r'dataset\Brain Tumor Data Set\metadata.csv'

# Separate preprocessing pipelines for CNN and ViT features
cnn_transforms = transforms.Compose([
    transforms.Resize((224, 224)),
    transforms.ToTensor(),
    transforms.Normalize([0.485, 0.456, 0.406],
                         [0.229, 0.224, 0.225])
])

vit_processor = ViTImageProcessor.from_pretrained("google/vit-base-patch16-224-in21k")

# Modified Dataset class method (or wrap) needed to provide two differently preprocessed images per sample

def preprocess_for_vit(image):
    # Convert PIL image to tensor normalized using ViT processor
    encoding = vit_processor(images=image, return_tensors="pt")
    return encoding['pixel_values'].squeeze(0)  # Remove batch dim added by processor

def get_data_loaders(batch_size=32, val_split=0.2):
    full_dataset = BrainMRIDataset(DATA_DIR, METADATA_CSV)

    # Modify dataset __getitem__ to return two versions of each image:
    # One preprocessed with cnn_transforms, one preprocessed with preprocess_for_vit
    # You might subclass BrainMRIDataset or modify __getitem__ directly.

    # Implement these changes in your dataset.py accordingly.

    indices = list(range(len(full_dataset)))
    labels = full_dataset.metadata['target'].values
    train_idx, val_idx = train_test_split(indices, test_size=val_split, stratify=labels, random_state=42)

    from torch.utils.data.sampler import SubsetRandomSampler
    train_sampler = SubsetRandomSampler(train_idx)
    val_sampler = SubsetRandomSampler(val_idx)

    train_loader = DataLoader(full_dataset, batch_size=batch_size, sampler=train_sampler, num_workers=4, pin_memory=True)
    val_loader = DataLoader(full_dataset, batch_size=batch_size, sampler=val_sampler, num_workers=4, pin_memory=True)

    return train_loader, val_loader


def train_one_epoch(model, dataloader, criterion, optimizer):
    model.train()
    running_loss = 0.0
    correct = 0
    total = 0

    loop = tqdm(dataloader, desc='Training')
    for samples in loop:
        # samples should return: (images_cnn, images_vit, labels)
        images_cnn = samples['image_cnn'].to(device)
        images_vit = samples['image_vit'].to(device)
        labels = samples['label'].to(device)

        optimizer.zero_grad()
        outputs = model(images_cnn, images_vit)
        loss = criterion(outputs, labels)
        loss.backward()
        optimizer.step()

        running_loss += loss.item() * images_cnn.size(0)
        preds = outputs.argmax(dim=1)
        correct += (preds == labels).sum().item()
        total += labels.size(0)

        loop.set_postfix(loss=running_loss / total, accuracy=correct / total)

    return running_loss / total, correct / total


def validate(model, dataloader, criterion):
    model.eval()
    running_loss = 0.0
    correct = 0
    total = 0

    with torch.no_grad():
        loop = tqdm(dataloader, desc='Validation')
        for samples in loop:
            images_cnn = samples['image_cnn'].to(device)
            images_vit = samples['image_vit'].to(device)
            labels = samples['label'].to(device)

            outputs = model(images_cnn, images_vit)
            loss = criterion(outputs, labels)

            running_loss += loss.item() * images_cnn.size(0)
            preds = outputs.argmax(dim=1)
            correct += (preds == labels).sum().item()
            total += labels.size(0)

            loop.set_postfix(loss=running_loss / total, accuracy=correct / total)

    return running_loss / total, correct / total


def main():
    epochs = 20
    batch_size = 32
    learning_rate = 1e-4
    num_classes = 2  # Adjust according to dataset

    print(f"Using device: {device}")

    train_loader, val_loader = get_data_loaders(batch_size=batch_size)

    model = HybridModel(num_classes=num_classes).to(device)
    criterion = nn.CrossEntropyLoss()
    optimizer = optim.Adam(model.parameters(), lr=learning_rate)
    scheduler = optim.lr_scheduler.StepLR(optimizer, step_size=7, gamma=0.1)

    best_val_acc = 0.0
    for epoch in range(epochs):
        print(f"\nEpoch {epoch + 1} of {epochs}")
        train_loss, train_acc = train_one_epoch(model, train_loader, criterion, optimizer)
        val_loss, val_acc = validate(model, val_loader, criterion)

        print(f"Training Loss: {train_loss:.4f}, Accuracy: {train_acc:.4f}")
        print(f"Validation Loss: {val_loss:.4f}, Accuracy: {val_acc:.4f}")

        if val_acc > best_val_acc:
            best_val_acc = val_acc
            torch.save(model.state_dict(), 'best_hybrid_model.pth')
            print("Saved best model")

        scheduler.step()

    print(f"Training finished. Best Validation Accuracy: {best_val_acc:.4f}")


if __name__ == '__main__':
    main()
import os
from PIL import Image
from tqdm import tqdm

def make_uniform_folder(source_dir, target_dir, size=(224,224), target_format='jpeg'):
    os.makedirs(target_dir, exist_ok=True)
    for fname in tqdm(os.listdir(source_dir)):
        if not fname.lower().endswith(('.jpg', '.jpeg', '.png', '.tif', '.bmp')):
            continue
        try:
            img = Image.open(os.path.join(source_dir, fname)).convert("RGB")
            img = img.resize(size)

            # Defensive fix: ensure types are strings
            base_name = os.path.splitext(fname)[0]
            if isinstance(base_name, tuple):
                print(f"Warning: base_name is tuple for file {fname}: {base_name}")
                base_name = base_name[0]

            clean_name = str(base_name) + '.' + str(target_format)
            img.save(os.path.join(target_dir, clean_name), target_format.upper())

        except Exception as e:
            print(f"Skipping {fname}: {e}")


def preprocess_dataset(root_dir, processed_root, size=(224,224)):
    """
    Walks over both Brain Tumor and Healthy folders and applies make_uniform_folder.
    """
    for category in ['Brain Tumor', 'Healthy']:
        in_dir = os.path.join(root_dir, category)
        out_dir = os.path.join(processed_root, category)
        make_uniform_folder(in_dir, out_dir, size=size)

if __name__ == "__main__":
    src_root = r'dataset\Brain Tumor Data Set\Brain Tumor Data Set'
    dst_root = r'dataset\Processed'
    preprocess_dataset(src_root, dst_root, size=(224,224))
import os
import pandas as pd
from PIL import Image
from torch.utils.data import Dataset

class BrainMRIDataset(Dataset):
    """
    Custom Dataset for Kaggle Brain Tumor Data Set.
    Expects:
        data_dir/
            ├─ Brain Tumor/
            └─ Healthy/
        metadata.csv
    """
    def __init__(self, data_dir, metadata_csv, transform=None):
        self.data_dir = data_dir
        self.metadata = pd.read_csv(metadata_csv)
        self.transform = transform

        # Map labels: 0 = healthy, 1 = tumor
        label_map = {'normal': 0, 'tumor': 1}
        self.metadata['target'] = self.metadata['class'].map(label_map)
        
    def __len__(self):
        return len(self.metadata)
    
    def __getitem__(self, idx):
        row = self.metadata.iloc[idx]
        subfolder = 'Brain Tumor' if row['class'] == 'tumor' else 'Healthy'
        img_path = os.path.join(self.data_dir, subfolder, row['filename'])
        image = Image.open(img_path).convert('RGB')
        label = row['target']
        if self.transform:
            image = self.transform(image)
        return image, label
import torch.nn as nn
import timm
import torch

class ViTBackbone(nn.Module):
    def __init__(self, model_name='vit_base_patch16_224', jft_checkpoint=None):
        super().__init__()
        # Initialize ViT model without classification head (num_classes=0)
        self.vit_model = timm.create_model(model_name, pretrained=False, num_classes=0)
        
        # Load pretrained JFT or ImageNet weights if checkpoint provided
        if jft_checkpoint:
            state_dict = torch.load(jft_checkpoint, map_location='cpu')
            self.vit_model.load_state_dict(state_dict, strict=False)

    def forward(self, x):
        # Forward pass through ViT backbone, output is embedding vector
        return self.vit_model(x)import torch
from torch import nn
from transformers import ViTModel, ViTImageProcessor

class ViTBackbone(nn.Module):
    def __init__(self, model_name="google/vit-base-patch16-224-in21k"):
        super().__init__()
        # Load pretrained ViT (without classification head)
        self.vit = ViTModel.from_pretrained(model_name)
        # Load corresponding image processor for preprocessing outside this class
        self.processor = ViTImageProcessor.from_pretrained(model_name)

    def forward(self, images):
        """
        images: Tensor of shape [B, 3, H, W], normalized appropriately
        Returns: CLS token embeddings of shape [B, hidden_size]
        """
        outputs = self.vit(images)
        # CLS token embedding is at position 0
        cls_embeddings = outputs.last_hidden_state[:, 0]
        return cls_embeddings
import torch
import torch.nn as nn
from models.resnet_backbone import ResNetBackbone
from models.vit_backbone import ViTBackbone

class HybridModel(nn.Module):
    def __init__(self, num_classes=4):
        super().__init__()
        self.resnet = ResNetBackbone()
        self.vit = ViTBackbone()
        self.classifier = nn.Sequential(
            nn.Linear(512 + 384, 256),
            nn.ReLU(),
            nn.Dropout(0.3),
            nn.Linear(256, num_classes)
        )
    
    def forward(self, x):
        cnn_feat = self.resnet(x)  # B x 512
        vit_feat = self.vit(x)     # B x 384
        fused = torch.cat([cnn_feat, vit_feat], dim=1)  # B x 896
        output = self.classifier(fused)  # B x num_classes
        return output
from torch.utils.data import Subset
from sklearn.model_selection import StratifiedKFold

def split_dataset(dataset, n_clients=3):
    """
    Splits dataset into n_clients stratified subsets.
    Returns list of Subset objects for each client.
    """
    labels = dataset.metadata['target'].values
    skf = StratifiedKFold(n_splits=n_clients, shuffle=True, random_state=42)
    subsets = []

    for _, idx in skf.split(range(len(dataset)), labels):
        subsets.append(Subset(dataset, idx))

    return subsets
import torch
from models.hybrid_model import HybridModel
from aggregation import fed_avg

class FLServer:
    def __init__(self, clients, device):
        self.clients = clients
        self.device = device
        self.global_model = HybridModel(num_classes=2).to(device)  # Adjust classes as needed

    def run_federated_learning(self, rounds=10, local_epochs=1):
        for r in range(rounds):
            print(f"\n=== Federated Round {r + 1} ===")
            global_weights = self.global_model.state_dict()
            client_updates = []

            for idx, client in enumerate(self.clients):
                client.model.load_state_dict(global_weights)
                weights, val_loss, val_acc = client.train_local(epochs=local_epochs)
                num_samples = len(client.train_loader.dataset)
                client_updates.append((weights, num_samples))
                print(f"Client {idx + 1} validation accuracy: {val_acc:.4f}")

            # Aggregate weights from all clients with FedAvg
            new_global_weights = fed_avg(client_updates)
            self.global_model.load_state_dict(new_global_weights)
            print(f"Round {r + 1} aggregation complete.")

        torch.save(self.global_model.state_dict(), "fedxvit_global_model.pth")
        print("Federated training finished and global model saved.")
import torch
from torch.utils.data import DataLoader
from torchvision import transforms
from dataset import BrainMRIDataset
from models.hybrid_model import HybridModel
from client import FLClient
from server import FLServer
from utils import split_dataset
import torch.nn as nn
import torch.optim as optim

device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')

def create_client_loaders():
    data_transforms = transforms.Compose([
        transforms.Resize((224, 224)),
        transforms.ToTensor(),
        transforms.Normalize([0.485, 0.456, 0.406],
                             [0.229, 0.224, 0.225])
    ])

    full_dataset = BrainMRIDataset('dataset/Processed',
                                  'dataset/Brain Tumor Data Set/metadata.csv',
                                  transform=data_transforms)

    client_subsets = split_dataset(full_dataset, n_clients=3)
    client_loaders = []

    for subset in client_subsets:
        loader = DataLoader(subset, batch_size=32, shuffle=True, num_workers=4, pin_memory=True)
        client_loaders.append(loader)
    return client_loaders

def main():
    client_loaders = create_client_loaders()

    clients = []
    criterion = nn.CrossEntropyLoss()

    for loader in client_loaders:
        model = HybridModel(num_classes=2).to(device)
        optimizer = optim.Adam(model.parameters(), lr=1e-4)

        # For local validation, reuse client loader here (or create val loaders per client)
        client = FLClient(model=model, train_loader=loader, val_loader=loader,
                          device=device, criterion=criterion, optimizer=optimizer)
        clients.append(client)

    server = FLServer(clients=clients, device=device)
    server.run_federated_learning(rounds=5, local_epochs=1)

if __name__ == "__main__":
    main()
import torch
from train import train_one_epoch, validate  # reuse existing functions

class FLClient:
    def __init__(self, model, train_loader, val_loader, device, criterion, optimizer):
        self.model = model
        self.train_loader = train_loader
        self.val_loader = val_loader
        self.device = device
        self.criterion = criterion
        self.optimizer = optimizer

    def train_local(self, epochs=1):
        self.model.to(self.device)
        for _ in range(epochs):
            train_one_epoch(self.model, self.train_loader, self.criterion, self.optimizer)
        val_loss, val_acc = validate(self.model, self.val_loader, self.criterion)
        return self.model.state_dict(), val_loss, val_acc
import torch

def fed_avg(updates):
    """
    FedAvg: Weighted averaging of model updates.
    updates: list of tuples (state_dict, num_samples)
    """
    total_samples = sum(num_samples for _, num_samples in updates)
    avg_state_dict = {}

    for key in updates[0][0].keys():
        avg_state_dict[key] = torch.zeros_like(updates[0][0][key])

    for state, num_samples in updates:
        for k in avg_state_dict.keys():
            avg_state_dict[k] += state[k] * (num_samples / total_samples)

    return avg_state_dict
import torch
from gradcam_plus import GradCAMPlusPlus
from attention_rollout import AttentionRollout

class HybridExplainer:
    def __init__(self, model, cnn_target_layer='features.6', discard_ratio=0.9):
        # cnn_target_layer depends on resnet backbone feature layer; adjust as needed
        self.model = model
        self.gradcam = GradCAMPlusPlus(self.model.resnet, cnn_target_layer)
        self.att_rollout = AttentionRollout(self.model.vit, discard_ratio=discard_ratio)

    def explain(self, input_tensor, class_idx=None):
        self.model.eval()
        with torch.no_grad():
            cam_map = self.gradcam.generate(input_tensor, class_idx)
            attn_map = self.att_rollout.generate(input_tensor)
        return cam_map, attn_map
import torch
from torchvision.models.feature_extraction import create_feature_extractor
from torch.nn import functional as F

class GradCAMPlusPlus:
    def __init__(self, model, target_layer):
        self.model = model.eval()
        self.target_layer = target_layer
        
        # Create hook for features and gradients
        self.feature_maps = None
        self.gradients = None
        
        def forward_hook(module, input, output):
            self.feature_maps = output.detach()
        
        def backward_hook(module, grad_in, grad_out):
            self.gradients = grad_out[0].detach()
        
        target_module = dict(self.model.named_modules())[target_layer]
        target_module.register_forward_hook(forward_hook)
        target_module.register_backward_hook(backward_hook)
    
    def generate(self, input_tensor, class_idx=None):
        self.model.zero_grad()
        output = self.model(input_tensor)

        if class_idx is None:
            class_idx = output.argmax(dim=1)
        
        loss = output[0, class_idx]
        loss.backward(retain_graph=True)

        weights = self._compute_weights()
        cam = (weights.unsqueeze(-1).unsqueeze(-1) * self.feature_maps[0]).sum(dim=0)
        cam = F.relu(cam)
        cam = cam - cam.min()
        cam = cam / (cam.max() + 1e-8)
        return cam.cpu().numpy()
    
    def _compute_weights(self):
        grads = self.gradients[0]  # Shape: C, H, W
        alpha_num = grads.pow(2)
        alpha_denom = 2*grads.pow(2) + (self.feature_maps[0] * grads.pow(3)).sum(dim=(1,2), keepdim=True)
        alpha_denom = torch.where(alpha_denom != 0.0, alpha_denom, torch.ones_like(alpha_denom))
        alphas = alpha_num / alpha_denom
        weights = (alphas * torch.relu(grads)).sum(dim=(1,2))
        return weights
import torch

class AttentionRollout:
    def __init__(self, model, discard_ratio=0.9):
        self.model = model.eval()
        self.discard_ratio = discard_ratio
        self.attention_maps = []

        for blk in self.model.blocks:
            blk.attn.attn_drop.register_forward_hook(self._hook_attention)

    def _hook_attention(self, module, input, output):
        self.attention_maps.append(output.detach())

    def generate(self, input_tensor):
        _ = self.model(input_tensor)  # Forward pass to fill attention_maps

        avg_attn = torch.stack(self.attention_maps).mean(dim=0)[0]  # [num_heads, tokens, tokens]
        avg_attn = avg_attn.mean(dim=0)  # Mean over heads → [tokens, tokens]

        # Discard low attention scores
        flat = avg_attn.flatten()
        val, idx = torch.topk(flat, int(flat.size(0)*self.discard_ratio))
        mask = torch.zeros_like(flat)
        mask[idx] = 1
        mask = mask.reshape(avg_attn.shape)

        # Attention rollout matrix
        attn_rollout = (avg_attn * mask).sum(dim=0)
        
        # Normalize between 0 and 1
        attn_rollout = attn_rollout - attn_rollout.min()
        attn_rollout = attn_rollout / (attn_rollout.max() + 1e-8)
        return attn_rollout.cpu().numpy()

C:\Users\admin>d:

D:\FedXViT>dir
 Volume in drive D has no label.
 Volume Serial Number is 54A0-A1BE

 Directory of D:\FedXViT

09/09/2025  11:37 PM    <DIR>          .
09/09/2025  11:37 PM    <DIR>          ..
09/03/2025  11:35 AM    <DIR>          dataset
09/03/2025  11:32 AM             1,154 dataset.py
09/03/2025  11:53 AM    <DIR>          explainability
09/03/2025  11:51 AM    <DIR>          federated
09/03/2025  11:39 AM    <DIR>          models
09/03/2025  11:37 AM             1,572 preprocessing.py
09/09/2025  11:37 PM               154 requirements.txt
09/09/2025  11:34 PM             5,379 train.py
09/03/2025  11:45 AM    <DIR>          __pycache__
               4 File(s)          8,259 bytes
               7 Dir(s)  904,437,334,016 bytes free

D:\FedXViT>tree
Folder PATH listing
Volume serial number is 54A0-A1BE
D:.
├───dataset
│   ├───Brain Tumor Data Set
│   │   └───Brain Tumor Data Set
│   │       ├───Brain Tumor
│   │       └───Healthy
│   └───Processed
│       ├───Brain Tumor
│       └───Healthy
├───explainability
├───federated
├───models
└───__pycache__

D:\FedXViT>

D:\FedXViT>


(base) C:\Users\admin>d:

(base) D:\>cd fedxvit

(base) D:\FedXViT>conda activate fedxvit

EnvironmentNameNotFound: Could not find conda environment: fedxvit
You can list all discoverable environments with `conda info --envs`.



(base) D:\FedXViT>python -m venv venv

(base) D:\FedXViT>.\venv\Scripts\activate

(venv) (base) D:\FedXViT>pip install -r requirements.txt
Collecting torch>=2.0.0 (from -r requirements.txt (line 1))
  Using cached torch-2.8.0-cp312-cp312-win_amd64.whl.metadata (30 kB)
Collecting torchvision>=0.15.0 (from -r requirements.txt (line 2))
  Using cached torchvision-0.23.0-cp312-cp312-win_amd64.whl.metadata (6.1 kB)
Collecting transformers>=4.40.0 (from -r requirements.txt (line 3))
  Using cached transformers-4.56.1-py3-none-any.whl.metadata (42 kB)
Collecting timm>=0.9.0 (from -r requirements.txt (line 4))
  Using cached timm-1.0.19-py3-none-any.whl.metadata (60 kB)
Collecting scikit-learn>=1.2.0 (from -r requirements.txt (line 5))
  Downloading scikit_learn-1.7.2-cp312-cp312-win_amd64.whl.metadata (11 kB)
Collecting pandas>=2.0.0 (from -r requirements.txt (line 6))
  Using cached pandas-2.3.2-cp312-cp312-win_amd64.whl.metadata (19 kB)
Collecting tqdm>=4.65.0 (from -r requirements.txt (line 7))
  Using cached tqdm-4.67.1-py3-none-any.whl.metadata (57 kB)
Collecting Pillow>=10.0.0 (from -r requirements.txt (line 8))
  Downloading pillow-11.3.0-cp312-cp312-win_amd64.whl.metadata (9.2 kB)
Collecting requests>=2.31.0 (from -r requirements.txt (line 9))
  Using cached requests-2.32.5-py3-none-any.whl.metadata (4.9 kB)
Collecting filelock (from torch>=2.0.0->-r requirements.txt (line 1))
  Using cached filelock-3.19.1-py3-none-any.whl.metadata (2.1 kB)
Collecting typing-extensions>=4.10.0 (from torch>=2.0.0->-r requirements.txt (line 1))
  Using cached typing_extensions-4.15.0-py3-none-any.whl.metadata (3.3 kB)
Collecting sympy>=1.13.3 (from torch>=2.0.0->-r requirements.txt (line 1))
  Using cached sympy-1.14.0-py3-none-any.whl.metadata (12 kB)
Collecting networkx (from torch>=2.0.0->-r requirements.txt (line 1))
  Downloading networkx-3.5-py3-none-any.whl.metadata (6.3 kB)
Collecting jinja2 (from torch>=2.0.0->-r requirements.txt (line 1))
  Using cached jinja2-3.1.6-py3-none-any.whl.metadata (2.9 kB)
Collecting fsspec (from torch>=2.0.0->-r requirements.txt (line 1))
  Using cached fsspec-2025.9.0-py3-none-any.whl.metadata (10 kB)
Collecting setuptools (from torch>=2.0.0->-r requirements.txt (line 1))
  Using cached setuptools-80.9.0-py3-none-any.whl.metadata (6.6 kB)
Collecting numpy (from torchvision>=0.15.0->-r requirements.txt (line 2))
  Downloading numpy-2.3.3-cp312-cp312-win_amd64.whl.metadata (60 kB)
Collecting huggingface-hub<1.0,>=0.34.0 (from transformers>=4.40.0->-r requirements.txt (line 3))
  Downloading huggingface_hub-0.35.0-py3-none-any.whl.metadata (14 kB)
Collecting packaging>=20.0 (from transformers>=4.40.0->-r requirements.txt (line 3))
  Using cached packaging-25.0-py3-none-any.whl.metadata (3.3 kB)
Collecting pyyaml>=5.1 (from transformers>=4.40.0->-r requirements.txt (line 3))
  Downloading PyYAML-6.0.2-cp312-cp312-win_amd64.whl.metadata (2.1 kB)
Collecting regex!=2019.12.17 (from transformers>=4.40.0->-r requirements.txt (line 3))
  Downloading regex-2025.9.1-cp312-cp312-win_amd64.whl.metadata (41 kB)
Collecting tokenizers<=0.23.0,>=0.22.0 (from transformers>=4.40.0->-r requirements.txt (line 3))
  Using cached tokenizers-0.22.0-cp39-abi3-win_amd64.whl.metadata (6.9 kB)
Collecting safetensors>=0.4.3 (from transformers>=4.40.0->-r requirements.txt (line 3))
  Using cached safetensors-0.6.2-cp38-abi3-win_amd64.whl.metadata (4.1 kB)
Collecting scipy>=1.8.0 (from scikit-learn>=1.2.0->-r requirements.txt (line 5))
  Downloading scipy-1.16.2-cp312-cp312-win_amd64.whl.metadata (60 kB)
Collecting joblib>=1.2.0 (from scikit-learn>=1.2.0->-r requirements.txt (line 5))
  Using cached joblib-1.5.2-py3-none-any.whl.metadata (5.6 kB)
Collecting threadpoolctl>=3.1.0 (from scikit-learn>=1.2.0->-r requirements.txt (line 5))
  Using cached threadpoolctl-3.6.0-py3-none-any.whl.metadata (13 kB)
Collecting python-dateutil>=2.8.2 (from pandas>=2.0.0->-r requirements.txt (line 6))
  Using cached python_dateutil-2.9.0.post0-py2.py3-none-any.whl.metadata (8.4 kB)
Collecting pytz>=2020.1 (from pandas>=2.0.0->-r requirements.txt (line 6))
  Using cached pytz-2025.2-py2.py3-none-any.whl.metadata (22 kB)
Collecting tzdata>=2022.7 (from pandas>=2.0.0->-r requirements.txt (line 6))
  Using cached tzdata-2025.2-py2.py3-none-any.whl.metadata (1.4 kB)
Collecting colorama (from tqdm>=4.65.0->-r requirements.txt (line 7))
  Using cached colorama-0.4.6-py2.py3-none-any.whl.metadata (17 kB)
Collecting charset_normalizer<4,>=2 (from requests>=2.31.0->-r requirements.txt (line 9))
  Downloading charset_normalizer-3.4.3-cp312-cp312-win_amd64.whl.metadata (37 kB)
Collecting idna<4,>=2.5 (from requests>=2.31.0->-r requirements.txt (line 9))
  Using cached idna-3.10-py3-none-any.whl.metadata (10 kB)
Collecting urllib3<3,>=1.21.1 (from requests>=2.31.0->-r requirements.txt (line 9))
  Using cached urllib3-2.5.0-py3-none-any.whl.metadata (6.5 kB)
Collecting certifi>=2017.4.17 (from requests>=2.31.0->-r requirements.txt (line 9))
  Using cached certifi-2025.8.3-py3-none-any.whl.metadata (2.4 kB)
Collecting six>=1.5 (from python-dateutil>=2.8.2->pandas>=2.0.0->-r requirements.txt (line 6))
  Using cached six-1.17.0-py2.py3-none-any.whl.metadata (1.7 kB)
Collecting mpmath<1.4,>=1.1.0 (from sympy>=1.13.3->torch>=2.0.0->-r requirements.txt (line 1))
  Using cached mpmath-1.3.0-py3-none-any.whl.metadata (8.6 kB)
Collecting MarkupSafe>=2.0 (from jinja2->torch>=2.0.0->-r requirements.txt (line 1))
  Downloading MarkupSafe-3.0.2-cp312-cp312-win_amd64.whl.metadata (4.1 kB)
Using cached torch-2.8.0-cp312-cp312-win_amd64.whl (241.3 MB)
Using cached torchvision-0.23.0-cp312-cp312-win_amd64.whl (1.6 MB)
Using cached transformers-4.56.1-py3-none-any.whl (11.6 MB)
Using cached timm-1.0.19-py3-none-any.whl (2.5 MB)
Downloading scikit_learn-1.7.2-cp312-cp312-win_amd64.whl (8.7 MB)
   ---------------------------------------- 8.7/8.7 MB 74.0 kB/s eta 0:00:00
Using cached pandas-2.3.2-cp312-cp312-win_amd64.whl (11.0 MB)
Using cached tqdm-4.67.1-py3-none-any.whl (78 kB)
Downloading pillow-11.3.0-cp312-cp312-win_amd64.whl (7.0 MB)
   ---------------------------------------- 7.0/7.0 MB 88.1 kB/s eta 0:00:00
Using cached requests-2.32.5-py3-none-any.whl (64 kB)
Using cached certifi-2025.8.3-py3-none-any.whl (161 kB)
Downloading charset_normalizer-3.4.3-cp312-cp312-win_amd64.whl (107 kB)
Downloading huggingface_hub-0.35.0-py3-none-any.whl (563 kB)
   ---------------------------------------- 563.4/563.4 kB 102.6 kB/s eta 0:00:00
Using cached fsspec-2025.9.0-py3-none-any.whl (199 kB)
Using cached idna-3.10-py3-none-any.whl (70 kB)
Using cached joblib-1.5.2-py3-none-any.whl (308 kB)
Downloading numpy-2.3.3-cp312-cp312-win_amd64.whl (12.8 MB)
   ---------------------------------------- 12.8/12.8 MB 90.6 kB/s eta 0:00:00
Using cached packaging-25.0-py3-none-any.whl (66 kB)
Using cached python_dateutil-2.9.0.post0-py2.py3-none-any.whl (229 kB)
Using cached pytz-2025.2-py2.py3-none-any.whl (509 kB)
Downloading PyYAML-6.0.2-cp312-cp312-win_amd64.whl (156 kB)
Downloading regex-2025.9.1-cp312-cp312-win_amd64.whl (275 kB)
Using cached safetensors-0.6.2-cp38-abi3-win_amd64.whl (320 kB)
Downloading scipy-1.16.2-cp312-cp312-win_amd64.whl (38.6 MB)
   ---------------------------------------- 38.6/38.6 MB 84.7 kB/s eta 0:00:00
Using cached sympy-1.14.0-py3-none-any.whl (6.3 MB)
Using cached threadpoolctl-3.6.0-py3-none-any.whl (18 kB)
Using cached tokenizers-0.22.0-cp39-abi3-win_amd64.whl (2.7 MB)
Using cached typing_extensions-4.15.0-py3-none-any.whl (44 kB)
Using cached tzdata-2025.2-py2.py3-none-any.whl (347 kB)
Using cached urllib3-2.5.0-py3-none-any.whl (129 kB)
Using cached colorama-0.4.6-py2.py3-none-any.whl (25 kB)
Using cached filelock-3.19.1-py3-none-any.whl (15 kB)
Using cached jinja2-3.1.6-py3-none-any.whl (134 kB)
Downloading networkx-3.5-py3-none-any.whl (2.0 MB)
   ---------------------------------------- 2.0/2.0 MB 77.7 kB/s eta 0:00:00
Using cached setuptools-80.9.0-py3-none-any.whl (1.2 MB)
Downloading MarkupSafe-3.0.2-cp312-cp312-win_amd64.whl (15 kB)
Using cached mpmath-1.3.0-py3-none-any.whl (536 kB)
Using cached six-1.17.0-py2.py3-none-any.whl (11 kB)
Installing collected packages: pytz, mpmath, urllib3, tzdata, typing-extensions, threadpoolctl, sympy, six, setuptools, safetensors, regex, pyyaml, Pillow, packaging, numpy, networkx, MarkupSafe, joblib, idna, fsspec, filelock, colorama, charset_normalizer, certifi, tqdm, scipy, requests, python-dateutil, jinja2, torch, scikit-learn, pandas, huggingface-hub, torchvision, tokenizers, transformers, timm
Successfully installed MarkupSafe-3.0.2 Pillow-11.3.0 certifi-2025.8.3 charset_normalizer-3.4.3 colorama-0.4.6 filelock-3.19.1 fsspec-2025.9.0 huggingface-hub-0.35.0 idna-3.10 jinja2-3.1.6 joblib-1.5.2 mpmath-1.3.0 networkx-3.5 numpy-2.3.3 packaging-25.0 pandas-2.3.2 python-dateutil-2.9.0.post0 pytz-2025.2 pyyaml-6.0.2 regex-2025.9.1 requests-2.32.5 safetensors-0.6.2 scikit-learn-1.7.2 scipy-1.16.2 setuptools-80.9.0 six-1.17.0 sympy-1.14.0 threadpoolctl-3.6.0 timm-1.0.19 tokenizers-0.22.0 torch-2.8.0 torchvision-0.23.0 tqdm-4.67.1 transformers-4.56.1 typing-extensions-4.15.0 tzdata-2025.2 urllib3-2.5.0

[notice] A new release of pip is available: 24.2 -> 25.2
[notice] To update, run: python.exe -m pip install --upgrade pip

(venv) (base) D:\FedXViT>python preprocessing.py
--- Starting Dataset Preprocessing ---
Processing Brain Tumor: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2513/2513 [00:34<00:00, 73.31it/s]
Processing Healthy: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2087/2087 [00:21<00:00, 99.30it/s]
Metadata CSV generated at dataset/metadata.csv

--- Preprocessing Complete ---

(venv) (base) D:\FedXViT># Run with default settings (25 epochs, batch size 16, LR 1e-4)
'#' is not recognized as an internal or external command,
operable program or batch file.

(venv) (base) D:\FedXViT>python train.py
Traceback (most recent call last):
  File "D:\FedXViT\train.py", line 13, in <module>
    from models.hybrid_model import HybridModel
ModuleNotFoundError: No module named 'models.hybrid_model'

(venv) (base) D:\FedXViT>
(venv) (base) D:\FedXViT># Or, run with custom settings
'#' is not recognized as an internal or external command,
operable program or batch file.

(venv) (base) D:\FedXViT>python train.py --epochs 50 --batch_size 8 --lr 5e-5
Traceback (most recent call last):
  File "D:\FedXViT\train.py", line 13, in <module>
    from models.hybrid_model import HybridModel
ModuleNotFoundError: No module named 'models.hybrid_model'

(venv) (base) D:\FedXViT>python train.py --epochs 50 --batch_size 8 --lr 5e-5
🚀 Using device: cpu
Traceback (most recent call last):
  File "D:\FedXViT\train.py", line 119, in <module>
    main(args)
  File "D:\FedXViT\train.py", line 83, in main
    model = HybridModel(num_classes=args.num_classes).to(device)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\FedXViT\models\hybrid.py", line 16, in __init__
    self.cnn_backbone = timm.create_model(
                        ^^^^^^^^^^^^^^^^^^
  File "D:\FedXViT\venv\Lib\site-packages\timm\models\_factory.py", line 138, in create_model
    model = create_fn(
            ^^^^^^^^^^
  File "D:\FedXViT\venv\Lib\site-packages\timm\models\efficientnet.py", line 2381, in efficientnetv2_s
    model = _gen_efficientnetv2_s('efficientnetv2_s', pretrained=pretrained, **kwargs)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\FedXViT\venv\Lib\site-packages\timm\models\efficientnet.py", line 924, in _gen_efficientnetv2_s
    model = _create_effnet(variant, pretrained, **model_kwargs)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\FedXViT\venv\Lib\site-packages\timm\models\efficientnet.py", line 450, in _create_effnet
    model = build_model_with_cfg(
            ^^^^^^^^^^^^^^^^^^^^^
  File "D:\FedXViT\venv\Lib\site-packages\timm\models\_builder.py", line 457, in build_model_with_cfg
    load_pretrained(
  File "D:\FedXViT\venv\Lib\site-packages\timm\models\_builder.py", line 236, in load_pretrained
    raise RuntimeError(f"No pretrained weights exist for {model_name}. Use `pretrained=False` for random init.")
RuntimeError: No pretrained weights exist for efficientnetv2_s. Use `pretrained=False` for random init.

(venv) (base) D:\FedXViT>nvidia-smi
Thu Sep 18 22:10:38 2025
+---------------------------------------------------------------------------------------+
| NVIDIA-SMI 536.99                 Driver Version: 536.99       CUDA Version: 12.2     |
|-----------------------------------------+----------------------+----------------------+
| GPU  Name                     TCC/WDDM  | Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |         Memory-Usage | GPU-Util  Compute M. |
|                                         |                      |               MIG M. |
|=========================================+======================+======================|
|   0  NVIDIA GeForce RTX 3060      WDDM  | 00000000:01:00.0  On |                  N/A |
| 40%   34C    P8              10W / 170W |    581MiB / 12288MiB |      1%      Default |
|                                         |                      |                  N/A |
+-----------------------------------------+----------------------+----------------------+

+---------------------------------------------------------------------------------------+
| Processes:                                                                            |
|  GPU   GI   CI        PID   Type   Process name                            GPU Memory |
|        ID   ID                                                             Usage      |
|=======================================================================================|
|    0   N/A  N/A      1280    C+G   ...oogle\Chrome\Application\chrome.exe    N/A      |
|    0   N/A  N/A      2284    C+G   ...5n1h2txyewy\ShellExperienceHost.exe    N/A      |
|    0   N/A  N/A      2868    C+G   ...CBS_cw5n1h2txyewy\TextInputHost.exe    N/A      |
|    0   N/A  N/A      8964    C+G   ...24.0_x64__8wekyb3d8bbwe\Copilot.exe    N/A      |
|    0   N/A  N/A     10264    C+G   ...ekyb3d8bbwe\PhoneExperienceHost.exe    N/A      |
|    0   N/A  N/A     10460    C+G   C:\Windows\explorer.exe                   N/A      |
|    0   N/A  N/A     10924    C+G   ....Search_cw5n1h2txyewy\SearchApp.exe    N/A      |
|    0   N/A  N/A     11356    C+G   ...t.LockApp_cw5n1h2txyewy\LockApp.exe    N/A      |
|    0   N/A  N/A     12696    C+G   ...cal\Microsoft\OneDrive\OneDrive.exe    N/A      |
|    0   N/A  N/A     15068    C+G   D:\Microsoft VS Code\Code.exe             N/A      |
|    0   N/A  N/A     20768    C+G   ...crosoft\Edge\Application\msedge.exe    N/A      |
+---------------------------------------------------------------------------------------+

(venv) (base) D:\FedXViT>pip uninstall torch torchvision torchaudio
Found existing installation: torch 2.8.0
Uninstalling torch-2.8.0:
  Would remove:
    d:\fedxvit\venv\lib\site-packages\functorch\*
    d:\fedxvit\venv\lib\site-packages\torch-2.8.0.dist-info\*
    d:\fedxvit\venv\lib\site-packages\torch\*
    d:\fedxvit\venv\lib\site-packages\torchgen\*
    d:\fedxvit\venv\scripts\torchfrtrace.exe
    d:\fedxvit\venv\scripts\torchrun.exe
Proceed (Y/n)? y
  Successfully uninstalled torch-2.8.0
Found existing installation: torchvision 0.23.0
Uninstalling torchvision-0.23.0:
  Would remove:
    d:\fedxvit\venv\lib\site-packages\torchvision-0.23.0.dist-info\*
    d:\fedxvit\venv\lib\site-packages\torchvision\*
Proceed (Y/n)? y
  Successfully uninstalled torchvision-0.23.0
WARNING: Skipping torchaudio as it is not installed.

(venv) (base) D:\FedXViT>pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
Looking in indexes: https://download.pytorch.org/whl/cu121
Collecting torch
  Downloading https://download.pytorch.org/whl/cu121/torch-2.5.1%2Bcu121-cp312-cp312-win_amd64.whl (2449.3 MB)
     ---------------------------------------- 2.4/2.4 GB 21.4 MB/s eta 0:00:00
Collecting torchvision
  Downloading https://download.pytorch.org/whl/cu121/torchvision-0.20.1%2Bcu121-cp312-cp312-win_amd64.whl (6.1 MB)
     ---------------------------------------- 6.1/6.1 MB 24.8 MB/s eta 0:00:00
Collecting torchaudio
  Downloading https://download.pytorch.org/whl/cu121/torchaudio-2.5.1%2Bcu121-cp312-cp312-win_amd64.whl (4.1 MB)
     ---------------------------------------- 4.1/4.1 MB 6.5 MB/s eta 0:00:00
Requirement already satisfied: filelock in d:\fedxvit\venv\lib\site-packages (from torch) (3.19.1)
Requirement already satisfied: typing-extensions>=4.8.0 in d:\fedxvit\venv\lib\site-packages (from torch) (4.15.0)
Requirement already satisfied: networkx in d:\fedxvit\venv\lib\site-packages (from torch) (3.5)
Requirement already satisfied: jinja2 in d:\fedxvit\venv\lib\site-packages (from torch) (3.1.6)
Requirement already satisfied: fsspec in d:\fedxvit\venv\lib\site-packages (from torch) (2025.9.0)
Requirement already satisfied: setuptools in d:\fedxvit\venv\lib\site-packages (from torch) (80.9.0)
Collecting sympy==1.13.1 (from torch)
  Downloading https://download.pytorch.org/whl/sympy-1.13.1-py3-none-any.whl (6.2 MB)
     ---------------------------------------- 6.2/6.2 MB 9.7 MB/s eta 0:00:00
Requirement already satisfied: mpmath<1.4,>=1.1.0 in d:\fedxvit\venv\lib\site-packages (from sympy==1.13.1->torch) (1.3.0)
Requirement already satisfied: numpy in d:\fedxvit\venv\lib\site-packages (from torchvision) (2.3.3)
Requirement already satisfied: pillow!=8.3.*,>=5.3.0 in d:\fedxvit\venv\lib\site-packages (from torchvision) (11.3.0)
Requirement already satisfied: MarkupSafe>=2.0 in d:\fedxvit\venv\lib\site-packages (from jinja2->torch) (3.0.2)
Installing collected packages: sympy, torch, torchvision, torchaudio
  Attempting uninstall: sympy
    Found existing installation: sympy 1.14.0
    Uninstalling sympy-1.14.0:
      Successfully uninstalled sympy-1.14.0
Successfully installed sympy-1.13.1 torch-2.5.1+cu121 torchaudio-2.5.1+cu121 torchvision-0.20.1+cu121

[notice] A new release of pip is available: 24.2 -> 25.2
[notice] To update, run: python.exe -m pip install --upgrade pip

(venv) (base) D:\FedXViT>python train.py --epochs 50 --batch_size 8 --lr 5e-5
🚀 Using device: cuda

🧠 Initializing DataLoaders...
  - Loading metadata from dataset/metadata.csv...
  - Found 4506 records.
  - Loading metadata from dataset/metadata.csv...
  - Found 4506 records.
  - Loading metadata from dataset/metadata.csv...
  - Found 4506 records.
  - Train loader: 3604 samples
  - Validation loader: 902 samples

🛠️ Building the Hybrid Model...
  - Initializing CNN Backbone (efficientnetv2_s.in21k_ft_in1k)...
Traceback (most recent call last):
  File "D:\FedXViT\train.py", line 112, in <module>
    main(args)
  File "D:\FedXViT\train.py", line 73, in main
    model = HybridModel(num_classes=args.num_classes).to(device)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\FedXViT\models\hybrid.py", line 10, in __init__
    self.cnn_backbone = timm.create_model(
                        ^^^^^^^^^^^^^^^^^^
  File "D:\FedXViT\venv\Lib\site-packages\timm\models\_factory.py", line 138, in create_model
    model = create_fn(
            ^^^^^^^^^^
  File "D:\FedXViT\venv\Lib\site-packages\timm\models\efficientnet.py", line 2381, in efficientnetv2_s
    model = _gen_efficientnetv2_s('efficientnetv2_s', pretrained=pretrained, **kwargs)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\FedXViT\venv\Lib\site-packages\timm\models\efficientnet.py", line 924, in _gen_efficientnetv2_s
    model = _create_effnet(variant, pretrained, **model_kwargs)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\FedXViT\venv\Lib\site-packages\timm\models\efficientnet.py", line 450, in _create_effnet
    model = build_model_with_cfg(
            ^^^^^^^^^^^^^^^^^^^^^
  File "D:\FedXViT\venv\Lib\site-packages\timm\models\_builder.py", line 425, in build_model_with_cfg
    pretrained_cfg = resolve_pretrained_cfg(
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\FedXViT\venv\Lib\site-packages\timm\models\_builder.py", line 368, in resolve_pretrained_cfg
    pretrained_cfg = get_pretrained_cfg(model_with_tag)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\FedXViT\venv\Lib\site-packages\timm\models\_registry.py", line 332, in get_pretrained_cfg
    raise RuntimeError(f'Invalid pretrained tag ({tag}) for {arch_name}.')
RuntimeError: Invalid pretrained tag (in21k_ft_in1k) for efficientnetv2_s.

(venv) (base) D:\FedXViT>python train.py --epochs 50 --batch_size 8 --lr 5e-5
🚀 Using device: cuda

🧠 Initializing DataLoaders...
  - Loading metadata from dataset/metadata.csv...
  - Found 4506 records.
  - Loading metadata from dataset/metadata.csv...
  - Found 4506 records.
  - Loading metadata from dataset/metadata.csv...
  - Found 4506 records.
  - Train loader: 3604 samples
  - Validation loader: 902 samples

🛠️ Building the Hybrid Model...
  - Initializing CNN Backbone (tf_efficientnetv2_s.in21k_ft_in1k)...
model.safetensors: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 86.5M/86.5M [00:02<00:00, 32.2MB/s]
D:\FedXViT\venv\Lib\site-packages\huggingface_hub\file_download.py:143: UserWarning: `huggingface_hub` cache-system uses symlinks by default to efficiently store duplicated files but your machine does not support them in C:\Users\admin\.cache\huggingface\hub\models--timm--tf_efficientnetv2_s.in21k_ft_in1k. Caching files will still work but in a degraded version that might require more space on your disk. This warning can be disabled by setting the `HF_HUB_DISABLE_SYMLINKS_WARNING` environment variable. For more details, see https://huggingface.co/docs/huggingface_hub/how-to-cache#limitations.
To support symlinks on Windows, you either need to activate Developer Mode or to run Python as an administrator. In order to activate developer mode, see this article: https://docs.microsoft.com/en-us/windows/apps/get-started/enable-your-device-for-development
  warnings.warn(message)
Unexpected keys (bn2.num_batches_tracked, bn2.bias, bn2.running_mean, bn2.running_var, bn2.weight, classifier.bias, classifier.weight, conv_head.weight) found while loading pretrained weights. This may be expected if model is being adapted.
  - Initializing ViT Backbone (vit_base_patch16_224_in21k)...
D:\FedXViT\venv\Lib\site-packages\timm\models\_factory.py:138: UserWarning: Mapping deprecated model name vit_base_patch16_224_in21k to current vit_base_patch16_224.augreg_in21k.
  model = create_fn(
model.safetensors: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 410M/410M [00:12<00:00, 31.8MB/s]
D:\FedXViT\venv\Lib\site-packages\huggingface_hub\file_download.py:143: UserWarning: `huggingface_hub` cache-system uses symlinks by default to efficiently store duplicated files but your machine does not support them in C:\Users\admin\.cache\huggingface\hub\models--timm--vit_base_patch16_224.augreg_in21k. Caching files will still work but in a degraded version that might require more space on your disk. This warning can be disabled by setting the `HF_HUB_DISABLE_SYMLINKS_WARNING` environment variable. For more details, see https://huggingface.co/docs/huggingface_hub/how-to-cache#limitations.
To support symlinks on Windows, you either need to activate Developer Mode or to run Python as an administrator. In order to activate developer mode, see this article: https://docs.microsoft.com/en-us/windows/apps/get-started/enable-your-device-for-development
  warnings.warn(message)
  - Building projection and classifier layers...
  - Model components built successfully.
✅ Model loaded onto 'cuda'.

🔥 Starting training loop...

--- Epoch 1/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:53<00:00,  3.98it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.37it/s]
Train Loss: 0.2501 | Train Acc: 0.9012
Valid Loss: 0.0805 | Valid Acc: 0.9756
✅ New best model saved with accuracy: 0.9756

--- Epoch 2/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:50<00:00,  4.08it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.49it/s]
Train Loss: 0.0665 | Train Acc: 0.9770
Valid Loss: 0.0773 | Valid Acc: 0.9845
✅ New best model saved with accuracy: 0.9845

--- Epoch 3/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:51<00:00,  4.05it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.35it/s]
Train Loss: 0.0573 | Train Acc: 0.9786
Valid Loss: 0.0480 | Valid Acc: 0.9867
✅ New best model saved with accuracy: 0.9867

--- Epoch 4/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:51<00:00,  4.05it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.36it/s]
Train Loss: 0.0309 | Train Acc: 0.9886
Valid Loss: 0.0402 | Valid Acc: 0.9889
✅ New best model saved with accuracy: 0.9889

--- Epoch 5/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:53<00:00,  3.99it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.39it/s]
Train Loss: 0.0267 | Train Acc: 0.9920
Valid Loss: 0.0372 | Valid Acc: 0.9911
✅ New best model saved with accuracy: 0.9911

--- Epoch 6/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:51<00:00,  4.04it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.39it/s]
Train Loss: 0.0146 | Train Acc: 0.9953
Valid Loss: 0.1653 | Valid Acc: 0.9656

--- Epoch 7/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:51<00:00,  4.04it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.41it/s]
Train Loss: 0.0246 | Train Acc: 0.9920
Valid Loss: 0.0361 | Valid Acc: 0.9933
✅ New best model saved with accuracy: 0.9933

--- Epoch 8/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:51<00:00,  4.03it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.36it/s]
Train Loss: 0.0216 | Train Acc: 0.9931
Valid Loss: 0.0431 | Valid Acc: 0.9867

--- Epoch 9/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:51<00:00,  4.03it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.37it/s]
Train Loss: 0.0141 | Train Acc: 0.9964
Valid Loss: 0.0583 | Valid Acc: 0.9823

--- Epoch 10/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:51<00:00,  4.03it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.32it/s]
Train Loss: 0.0145 | Train Acc: 0.9945
Valid Loss: 0.0612 | Valid Acc: 0.9900

--- Epoch 11/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:51<00:00,  4.03it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.33it/s]
Train Loss: 0.0041 | Train Acc: 0.9992
Valid Loss: 0.0565 | Valid Acc: 0.9945
✅ New best model saved with accuracy: 0.9945

--- Epoch 12/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:51<00:00,  4.03it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.36it/s]
Train Loss: 0.0039 | Train Acc: 0.9986
Valid Loss: 0.0507 | Valid Acc: 0.9889

--- Epoch 13/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:52<00:00,  4.02it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.37it/s]
Train Loss: 0.0163 | Train Acc: 0.9947
Valid Loss: 0.0446 | Valid Acc: 0.9889

--- Epoch 14/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:52<00:00,  4.03it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.39it/s]
Train Loss: 0.0125 | Train Acc: 0.9956
Valid Loss: 0.0369 | Valid Acc: 0.9945

--- Epoch 15/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:52<00:00,  4.02it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.32it/s]
Train Loss: 0.0071 | Train Acc: 0.9969
Valid Loss: 0.0342 | Valid Acc: 0.9956
✅ New best model saved with accuracy: 0.9956

--- Epoch 16/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:51<00:00,  4.04it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.37it/s]
Train Loss: 0.0122 | Train Acc: 0.9969
Valid Loss: 0.0239 | Valid Acc: 0.9956

--- Epoch 17/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:52<00:00,  4.03it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.39it/s]
Train Loss: 0.0016 | Train Acc: 0.9994
Valid Loss: 0.0299 | Valid Acc: 0.9956

--- Epoch 18/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:52<00:00,  4.02it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.34it/s]
Train Loss: 0.0049 | Train Acc: 0.9986
Valid Loss: 0.0382 | Valid Acc: 0.9956

--- Epoch 19/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:53<00:00,  3.99it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.42it/s]
Train Loss: 0.0036 | Train Acc: 0.9986
Valid Loss: 0.0993 | Valid Acc: 0.9800

--- Epoch 20/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:52<00:00,  4.02it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.37it/s]
Train Loss: 0.0161 | Train Acc: 0.9964
Valid Loss: 0.0200 | Valid Acc: 0.9956

--- Epoch 21/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:53<00:00,  3.99it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.34it/s]
Train Loss: 0.0043 | Train Acc: 0.9992
Valid Loss: 0.0375 | Valid Acc: 0.9945

--- Epoch 22/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:52<00:00,  4.01it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.40it/s]
Train Loss: 0.0005 | Train Acc: 1.0000
Valid Loss: 0.0390 | Valid Acc: 0.9956

--- Epoch 23/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:53<00:00,  3.99it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.36it/s]
Train Loss: 0.0033 | Train Acc: 0.9986
Valid Loss: 0.0521 | Valid Acc: 0.9956

--- Epoch 24/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:52<00:00,  4.02it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.36it/s]
Train Loss: 0.0011 | Train Acc: 0.9994
Valid Loss: 0.0477 | Valid Acc: 0.9933

--- Epoch 25/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:52<00:00,  4.02it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.38it/s]
Train Loss: 0.0091 | Train Acc: 0.9972
Valid Loss: 0.0328 | Valid Acc: 0.9922

--- Epoch 26/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:52<00:00,  4.02it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.38it/s]
Train Loss: 0.0019 | Train Acc: 0.9994
Valid Loss: 0.0398 | Valid Acc: 0.9956

--- Epoch 27/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:52<00:00,  4.02it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.30it/s]
Train Loss: 0.0031 | Train Acc: 0.9992
Valid Loss: 0.0374 | Valid Acc: 0.9933

--- Epoch 28/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:53<00:00,  3.96it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.28it/s]
Train Loss: 0.0022 | Train Acc: 0.9994
Valid Loss: 0.0474 | Valid Acc: 0.9945

--- Epoch 29/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:52<00:00,  4.00it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.36it/s]
Train Loss: 0.0002 | Train Acc: 1.0000
Valid Loss: 0.0424 | Valid Acc: 0.9945

--- Epoch 30/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:55<00:00,  3.90it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:16<00:00,  6.97it/s]
Train Loss: 0.0006 | Train Acc: 0.9997
Valid Loss: 0.0525 | Valid Acc: 0.9945

--- Epoch 31/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:52<00:00,  4.02it/s]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 113/113 [00:15<00:00,  7.15it/s]
Train Loss: 0.0033 | Train Acc: 0.9992
Valid Loss: 0.0363 | Valid Acc: 0.9956

--- Epoch 32/50 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 451/451 [01:55<00:00,  3.90it/s]
Validation:   0%|                                                                                                                                                                         | 0/113 [00:00<?, ?it/s]Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "C:\ProgramData\anaconda3\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\ProgramData\anaconda3\Lib\multiprocessing\spawn.py", line 131, in _main
    prepare(preparation_data)
  File "C:\ProgramData\anaconda3\Lib\multiprocessing\spawn.py", line 246, in prepare
    _fixup_main_from_path(data['init_main_from_path'])
  File "C:\ProgramData\anaconda3\Lib\multiprocessing\spawn.py", line 297, in _fixup_main_from_path
    main_content = runpy.run_path(main_path,
                   ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen runpy>", line 286, in run_path
  File "<frozen runpy>", line 259, in _get_code_from_file
  File "D:\FedXViT\train.py", line 121
    parser.add_ार्मalidation split ratio from the training set')
                                                              ^
SyntaxError: unterminated string literal (detected at line 121)


----------------------------------------------------------------------------------------------------------------------------------------------------------


(venv) (base) D:\FedXViT>python train.py --num_classes 4 --batch_size 16 --epochs 30
🚀 Using device: cuda

🧠 Initializing DataLoaders for 4-class dataset...
  - Class mapping: {'glioma': 0, 'meningioma': 1, 'notumor': 2, 'pituitary': 3}
  - Total training images: 5712
  - Splitting into 4569 train and 1143 validation images.
  - Total test images: 1311

🛠️ Building the Hybrid Model...
  - Initializing CNN Backbone (tf_efficientnetv2_s.in21k_ft_in1k)...
Unexpected keys (bn2.num_batches_tracked, bn2.bias, bn2.running_mean, bn2.running_var, bn2.weight, classifier.bias, classifier.weight, conv_head.weight) found while loading pretrained weights. This may be expected if model is being adapted.  - Initializing ViT Backbone (vit_base_patch16_224_in21k)...
D:\FedXViT\venv\Lib\site-packages\timm\models\_factory.py:138: UserWarning: Mapping deprecated model name vit_base_patch16_224_in21k to current vit_base_patch16_224.augreg_in21k.
  model = create_fn(
  - Building projection and classifier layers...
  - Model components built successfully.

🔥 Starting training loop...

--- Epoch 1/30 ---
Training: 100%|██████████████████████████████████████████████████████████████████████| 286/286 [05:36<00:00,  1.18s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:15<00:00,  4.68it/s]
Train Loss: 0.5740 | Train Acc: 0.8026
Valid Loss: 0.2381 | Valid Acc: 0.9134
✅ New best model saved with accuracy: 0.9134

--- Epoch 2/30 ---
Training:  59%|███████████████████████████████████████████████████████████████████████████████████████████████▏         Training:  59%|███████████████████████████████████████████████████████████████████████████████████████████████▋         Training:  60%|████████████████████████████████████████████████████████████████████████████████████████████████▎        Training:  60%|████████████████████████████████████████████████████████████████████████████████████████████████▊        Training:  60%|█████████████████████████████████████████████████████████████████████████████████████████████████▍       Training:  61%|█████████████████████████████████████████████████████████████████████████████████████████████████▉                                               Training:  61%|█████████████████████████████████████████████████████████████████████Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [05:40<00:00,  1.19s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:15<00:00,  4.71it/s]
Train Loss: 0.1997 | Train Acc: 0.9251
Valid Loss: 0.1463 | Valid Acc: 0.9361
✅ New best model saved with accuracy: 0.9361

--- Epoch 3/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [05:39<00:00,  1.19s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:18<00:00,  3.89it/s]
Train Loss: 0.1475 | Train Acc: 0.9497
Valid Loss: 0.1733 | Valid Acc: 0.9414
✅ New best model saved with accuracy: 0.9414

--- Epoch 4/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [04:25<00:00,  1.08it/s]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:15<00:00,  4.74it/s]
Train Loss: 0.1139 | Train Acc: 0.9597
Valid Loss: 0.1405 | Valid Acc: 0.9571
✅ New best model saved with accuracy: 0.9571

--- Epoch 5/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [04:33<00:00,  1.05it/s]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:24<00:00,  2.92it/s]
Train Loss: 0.0917 | Train Acc: 0.9648
Valid Loss: 0.1248 | Valid Acc: 0.9554

--- Epoch 6/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [04:31<00:00,  1.05it/s]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:15<00:00,  4.75it/s]
Train Loss: 0.0848 | Train Acc: 0.9724
Valid Loss: 0.1655 | Valid Acc: 0.9528

--- Epoch 7/30 ---
Training:  30%|███████████████████████████████████████████████████████████████████▌                                                                                                                                Training:  31%|████████████████████████████████████████████████████████████████████▎                                                                                                                               Training:  31%|█████████████████████████████████████████████████████████████████████                                                                                                                               Training:  31%|█████████████████████████████████████████████████████████████████████▊                                                                                                                              Training:  32%|██████████████████████████████████████████████████████████████████████▋                                                                                                                             Training:  32%|███████████████████████████████████████████████████████████████████████▍                                                                                                                            Training:  33%|████████████████████████████████████████████████████████████████████████▏                                                                                                                           Training:  33%|████████████████████████████████████████████████████████████████████████▉                                                                                                                           Training:  33%|█████████████████████████████████████████████████████████████████████████▋                                                                                                                          Training:  34%|██████████████████████████████████████████████████████████████████████████▌                                                                                                                         Training:  34%|███████████████████████████████████████████████████████████████████████████▎                                                                                                                        Training:  34%|████████████████████████████████████████████████████████████████████████████                                                                                                                        Training:  35%|████████████████████████████████████████████████████████████████████████████▊                                                                                                                       Training:  35%|█████████████████████████████████████████████████████████████████████████████▎                                                                                                                      Training:  35%|██████████████████████████████████████████████████████████████████████████████                                                                                                                      Training:  36%|██████████████████████████████████████████████████████████████████████████████▊                                                                                                                     Training:  36%|███████████████████████████████████████████████████████████████████████████████▌                                                                                                                    Training:  36%|████████████████████████████████████████████████████████████████████████████████▎                                                                                                                   Training:  37%|█████████████████████████████████████████████████████████████████████████████████▏                                                                                                                  Training:  37%|█████████████████████████████████████████████████████████████████████████████████▉                                                                                                                  Training:  37%|██████████████████████████████████████████████████████████████████████████████████▋                                                                                                                 Training:  38%|███████████████████████████████████████████████████████████████████████████████████▍                                                                                                                Training:  38%|████████████████████████████████████████████████████████████████████████████████████▏                                                                                                               Training:  38%|█████████████████████████████████████████████████████████████████████████████████████                                                                                                               Training:  39%|█████████████████████████████████████████████████████████████████████████████████████▊                                                                                                              Training:  39%|██████████████████████████████████████████████████████████████████████████████████████▌                                                                                                             Training:  40%|███████████████████████████████████████████████████████████████████████████████████████▎                                                                                                            Training:  40%|████████████████████████████████████████████████████████████████████████████████████████                                                                                                            Training:  40%|████████████████████████████████████████████████████████████████████████████████████████▊                                                                                                           Training:  41%|█████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                          Training:  41%|██████████████████████████████████████████████████████████████████████████████████████████▍                                                                                                         Training:  41%|███████████████████████████████████████████████████████████████████████████████████████████▏                                                                                                        Training:  42%|███████████████████████████████████████████████████████████████████████████████████████████▉                                                                                                        Training:  42%|████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                       Training:  42%|█████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                                      Training:  43%|██████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                                     Training:  43%|███████████████████████████████████████████████████████████████████████████████████████████████                                                                                                     Training:  43%|███████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                                    Training:  44%|████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                                   Training:  44%|█████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                                  Training:  44%|██████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                                 Training:  45%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                                                                                                 Training:  45%|███████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                Training:  45%|████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                                               Training:  46%|█████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                              Training:  46%|██████████████████████████████████████████████████████████████████████████████████████████████████████                                                                                              Training:  47%|██████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                             Training:  47%|███████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                            Training:  47%|████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                           Training:  48%|█████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                                           Training:  48%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                          Training:  48%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                         Training:  49%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                                        Training:  49%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                       Training:  49%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                                                       Training:  50%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                      Training:  50%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                     Training:  50%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                    Training:  51%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                                    Training:  51%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                   Training:  51%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                  Training:  52%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                 Training:  52%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                Training:  52%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                                                Training:  53%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                               Training:  53%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                              Training:  53%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                             Training:  54%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                             Training:  54%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                            Training:  55%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                           Training:  55%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                          Training:  55%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                          Training:  56%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                         Training:  56%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                        Training:  56%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                       Training:  57%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                      Training:  57%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                                      Training:  57%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                     Training:  58%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                    Training:  58%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                   Training:  58%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                   Training:  59%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                  Training:  59%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                 Training:  59%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                Training:  60%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                               Training:  60%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                               Training:  60%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                              Training:  61%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                             Training:  61%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                            Training:  62%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                            Training:  62%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                           Training:  62%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                          Training:  63%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                         Training:  63%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                         Training:  63%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                        Training:  64%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                       Training:  64%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                      Training:  64%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                     Training:  65%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                     Training:  65%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                    Training:  65%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                   Training:  66%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                  Training:  66%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                  Training:  66%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                 Training:  67%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                Training:  67%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                               Training:  67%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                              Training:  68%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                              Training:  68%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                             Training:  69%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                            Training:  69%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                           Training:  69%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                           Training:  70%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                          Training:  70%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                         Training:  70%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                        Training:  71%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                        Training:  71%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                       Training:  71%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                      Training:  72%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                     Training:  72%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                    Training:  72%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                    Training:  73%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                   Training:  73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                  Training:  73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 Training:  74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                 Training:  74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                Training:  74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                               Training:  75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                              Training:  75%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                             Training:  76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                             Training:  76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                            Training:  76%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                           Training:  77%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                          Training:  77%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                          Training:  77%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                         Training:  78%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                        Training:  78%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                       Training:  78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                       Training:  79%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                      Training:  79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                     Training:  79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                    Training:  80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                   Training:  80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                   Training:  80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                  Training:  81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                 Training:  81%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                Training:  81%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                Training:  82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊               Training:  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌              Training:  83%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎             Training:  83%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏            Training:  83%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉            Training:  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋           Training:  84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍          Training:  84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏         Training:  85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████         Training:  85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊        Training:  85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌       Training:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎      Training:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████      Training:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊     Training:  87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋    Training:  87%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍   Training:  87%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏  Training:  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉  Training:  88%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋ Training:  88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌Training:  89%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  89%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  90%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  90%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  90%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  95%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  95%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  95%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  97%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  98%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  98%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  98%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training:  99%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [04:38<00:00,  1.03it/s]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:15<00:00,  4.70it/s]
Train Loss: 0.0689 | Train Acc: 0.9759
Valid Loss: 0.1024 | Valid Acc: 0.9738
✅ New best model saved with accuracy: 0.9738

--- Epoch 8/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [05:53<00:00,  1.24s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:15<00:00,  4.75it/s]
Train Loss: 0.0805 | Train Acc: 0.9748
Valid Loss: 0.0954 | Valid Acc: 0.9650

--- Epoch 9/30 ---
Training:  34%|████████████████████████████████████████████████████████████████████████████                                                                                                                                                  Training:  35%|████████████████████████████████████████████████████████████████████████████▊                                                                                                                                                 Training:  35%|█████████████████████████████████████████████████████████████████████████████▎                                                                                                                                               |Training:  35%|██████████████████████████████████████████████████████████████████████████████                                                                                                                                               |Training:  36%|██████████████████████████████████████████████████████████████████████████████▊                                                                                                                                              |Training:  36%|███████████████████████████████████████████████████████████████████████████████▌                                                                                                                                             |Training:  36%|████████████████████████████████████████████████████████████████████████████████▎                                                                                                                                            |Training:  37%|█████████████████████████████████████████████████████████████████████████████████▏                                                                                                                                           |Training:  37%|█████████████████████████████████████████████████████████████████████████████████▉                                                                                                                                           |Training:  37%|██████████████████████████████████████████████████████████████████████████████████▋                                                                                                                                          |Training:  38%|███████████████████████████████████████████████████████████████████████████████████▍                                                                                                                                         |Training:  38%|████████████████████████████████████████████████████████████████████████████████████▏                                                                                                                                        |Training:  38%|█████████████████████████████████████████████████████████████████████████████████████                                                                                                                                        |Training:  39%|█████████████████████████████████████████████████████████████████████████████████████▊                                                                                                                                       |Training:  39%|██████████████████████████████████████████████████████████████████████████████████████▌                                                                                                                                      |Training:  40%|███████████████████████████████████████████████████████████████████████████████████████▎                                                                                                                                     |Training:  40%|████████████████████████████████████████████████████████████████████████████████████████                                                                                                                                     |Training:  40%|████████████████████████████████████████████████████████████████████████████████████████▊                                                                                                                                    |Training:  41%|█████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                                                   |Training:  41%|██████████████████████████████████████████████████████████████████████████████████████████▍                                                                                                                                  |Training:  41%|███████████████████████████████████████████████████████████████████████████████████████████▏                                                                                                                                 |Training:  42%|███████████████████████████████████████████████████████████████████████████████████████████▉                                                                                                                                 |Training:  42%|████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                                                |Training:  42%|█████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                                                               |Training:  43%|██████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                                                              |Training:  43%|███████████████████████████████████████████████████████████████████████████████████████████████                                                                                                                              |Training:  43%|███████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                                                             |Training:  44%|████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                                                            |Training:  44%|█████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                                                           |Training:  44%|██████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                                                          |Training:  45%|██████████████████████████████████████████████████████████████████████████████████████████████████▉                                                                                                                          |Training:  45%|███████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                                         |Training:  45%|████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                                                                        |Training:  46%|█████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                                                       |Training:  46%|██████████████████████████████████████████████████████████████████████████████████████████████████████                                                                                                                       |Training:  47%|██████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                                                      |Training:  47%|███████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                                                     |Training:  47%|████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                                                    |Training:  48%|█████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                                                                    |Training:  48%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                                                   |Training:  48%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                                  |Training:  49%|███████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                                                                 |Training:  49%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                                                |Training:  49%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                                                                                |Training:  50%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                               |Training:  50%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                                              |Training:  50%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                                             |Training:  51%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                                                             |Training:  51%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                                            |Training:  51%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                                           |Training:  52%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                                          |Training:  52%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                                         |Training:  52%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                                                                         |Training:  53%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                        |Training:  53%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                                                       |Training:  53%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                                      |Training:  54%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                                                      |Training:  54%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                                     |Training:  55%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                                    |Training:  55%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                                   |Training:  55%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                                                   |Training:  56%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                                  |Training:  56%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                 |Training:  56%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                                                |Training:  57%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                               |Training:  57%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                                                               |Training:  57%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                              |Training:  58%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                                             |Training:  58%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                            |Training:  58%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                                            |Training:  59%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                           |Training:  59%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                          |Training:  59%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                         |Training:  60%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                        |Training:  60%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                                                        |Training:  60%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                       |Training:  61%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                                      |Training:  61%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                     |Training:  62%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                                     |Training:  62%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                    |Training:  62%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                   |Training:  63%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                  |Training:  63%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                                  |Training:  63%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                 |Training:  64%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                |Training:  64%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                               |Training:  64%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                              |Training:  65%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                                              |Training:  65%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                             |Training:  65%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                            |Training:  66%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                           |Training:  66%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                           |Training:  66%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                          |Training:  67%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                         |Training:  67%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                        |Training:  67%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                       |Training:  68%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                                       |Training:  68%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                      |Training:  69%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                     |Training:  69%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                    |Training:  69%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                    |Training:  70%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                   |Training:  70%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                  |Training:  70%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                 |Training:  71%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                 |Training:  71%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                |Training:  71%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                               |Training:  72%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                              |Training:  72%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                             |Training:  72%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                             |Training:  73%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                            |Training:  73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                           |Training:  73%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                          |Training:  74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                          |Training:  74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                         |Training:  74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                        |Training:  75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                       |Training:  75%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                      |Training:  76%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                      |Training:  76%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                     |Training:  76%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                    |Training:  77%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                   |Training:  77%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                   |Training:  77%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                  |Training:  78%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                 |Training:  78%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                |Training:  78%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                |Training:  79%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                               |Training:  79%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                              |Training:  79%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                             |Training:  80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                            |Training:  80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                            |Training:  80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                           |Training:  81%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                          |Training:  81%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                         |Training:  81%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                         |Training:  82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                        |Training:  82%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                       |Training:  83%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                      |Training:  83%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                     |Training:  83%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                     |Training:  84%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                    |Training:  84%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                   |Training:  84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                  |Training:  85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                  |Training:  85%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                 |Training:  85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                |Training:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                               |Training:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                               |Training:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                              |Training:  87%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                             |Training:  87%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                            |Training:  87%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                           |Training:  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                           |Training:  88%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                          |Training:  88%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                         |Training:  89%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                        |Training:  89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                        |Training:  90%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                       |Training:  90%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                      |Training:  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                     |Training:  91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                    |Training:  91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                    |Training:  91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   |Training:  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                  |Training:  92%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                 |Training:  92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                 |Training:  93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                |Training:  93%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌               |Training:  93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎              |Training:  94%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████              |Training:  94%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊             |Training:  94%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋            |Training:  95%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍           |Training:  95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏          |Training:  95%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉          |Training:  96%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋         |Training:  96%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌        |Training:  97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎       |Training:  97%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████       |Training:  97%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊      |Training:  98%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌     |Training:  98%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎    |Training:  98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏   |Training:  99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉   |Training:  99%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋  |Training:  99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍ |Training: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏|Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████|Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [05:30<00:00,  1.16s/it]
Validating/Testing: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:24<00:00,  2.92it/s]
Train Loss: 0.0636 | Train Acc: 0.9781
Valid Loss: 0.0919 | Valid Acc: 0.9694

--- Epoch 10/30 ---
Training: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [05:23<00:00,  1.13s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:15<00:00,  4.73it/s]
Train Loss: 0.0666 | Train Acc: 0.9775
Valid Loss: 0.0896 | Valid Acc: 0.9641

--- Epoch 11/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [05:26<00:00,  1.14s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:15<00:00,  4.66it/s]
Train Loss: 0.0573 | Train Acc: 0.9799
Valid Loss: 0.0858 | Valid Acc: 0.9764
✅ New best model saved with accuracy: 0.9764

--- Epoch 12/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:24<00:00,  1.34s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:18<00:00,  3.93it/s]
Train Loss: 0.0548 | Train Acc: 0.9814
Valid Loss: 0.0783 | Valid Acc: 0.9738

--- Epoch 13/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:26<00:00,  1.35s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:18<00:00,  3.93it/s]
Train Loss: 0.0522 | Train Acc: 0.9801
Valid Loss: 0.0874 | Valid Acc: 0.9746

--- Epoch 14/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:12<00:00,  1.30s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:24<00:00,  2.94it/s]
Train Loss: 0.0408 | Train Acc: 0.9856
Valid Loss: 0.0645 | Valid Acc: 0.9834
✅ New best model saved with accuracy: 0.9834

--- Epoch 15/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:14<00:00,  1.31s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:24<00:00,  2.95it/s]
Train Loss: 0.0427 | Train Acc: 0.9853
Valid Loss: 0.0846 | Valid Acc: 0.9755

--- Epoch 16/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:00<00:00,  1.26s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:16<00:00,  4.32it/s]
Train Loss: 0.0319 | Train Acc: 0.9893
Valid Loss: 0.0824 | Valid Acc: 0.9808

--- Epoch 17/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [05:43<00:00,  1.20s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:30<00:00,  2.33it/s]
Train Loss: 0.0341 | Train Acc: 0.9884
Valid Loss: 0.0642 | Valid Acc: 0.9825

--- Epoch 18/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [05:22<00:00,  1.13s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:15<00:00,  4.72it/s]
Train Loss: 0.0342 | Train Acc: 0.9891
Valid Loss: 0.0860 | Valid Acc: 0.9755

--- Epoch 19/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:24<00:00,  1.34s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:18<00:00,  3.92it/s]
Train Loss: 0.0309 | Train Acc: 0.9895
Valid Loss: 0.0704 | Valid Acc: 0.9764

--- Epoch 20/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:26<00:00,  1.35s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:18<00:00,  3.91it/s]
Train Loss: 0.0242 | Train Acc: 0.9910
Valid Loss: 0.0587 | Valid Acc: 0.9808

--- Epoch 21/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:12<00:00,  1.30s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:24<00:00,  2.94it/s]
Train Loss: 0.0261 | Train Acc: 0.9912
Valid Loss: 0.0817 | Valid Acc: 0.9781

--- Epoch 22/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:13<00:00,  1.31s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:24<00:00,  2.95it/s]
Train Loss: 0.0207 | Train Acc: 0.9937
Valid Loss: 0.0834 | Valid Acc: 0.9825

--- Epoch 23/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:01<00:00,  1.26s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:16<00:00,  4.35it/s]
Train Loss: 0.0209 | Train Acc: 0.9937
Valid Loss: 0.0692 | Valid Acc: 0.9808

--- Epoch 24/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [05:43<00:00,  1.20s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:30<00:00,  2.34it/s]
Train Loss: 0.0252 | Train Acc: 0.9915
Valid Loss: 0.0433 | Valid Acc: 0.9843
✅ New best model saved with accuracy: 0.9843

--- Epoch 25/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [05:22<00:00,  1.13s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:15<00:00,  4.71it/s]
Train Loss: 0.0203 | Train Acc: 0.9923
Valid Loss: 0.0624 | Valid Acc: 0.9808

--- Epoch 26/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:24<00:00,  1.34s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:18<00:00,  3.90it/s]
Train Loss: 0.0186 | Train Acc: 0.9932
Valid Loss: 0.0478 | Valid Acc: 0.9843

--- Epoch 27/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:09<00:00,  1.29s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:16<00:00,  4.33it/s]
Train Loss: 0.0155 | Train Acc: 0.9934
Valid Loss: 0.0581 | Valid Acc: 0.9816

--- Epoch 28/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:09<00:00,  1.29s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:16<00:00,  4.31it/s]
Train Loss: 0.0157 | Train Acc: 0.9947
Valid Loss: 0.0434 | Valid Acc: 0.9851
✅ New best model saved with accuracy: 0.9851

--- Epoch 29/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:09<00:00,  1.29s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:16<00:00,  4.32it/s]
Train Loss: 0.0161 | Train Acc: 0.9943
Valid Loss: 0.0616 | Valid Acc: 0.9860
✅ New best model saved with accuracy: 0.9860

--- Epoch 30/30 ---
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 286/286 [06:09<00:00,  1.29s/it]
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 72/72 [00:16<00:00,  4.34it/s]
Train Loss: 0.0144 | Train Acc: 0.9943
Valid Loss: 0.0640 | Valid Acc: 0.9808

Training finished!
🏆 Best Validation Accuracy: 0.9860

🔬 Loading best model and running final evaluation on the unseen test set...
D:\FedXViT\train.py:102: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  model.load_state_dict(torch.load(args.model_save_path))
Validating/Testing: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 82/82 [00:18<00:00,  4.45it/s]
🎯 Final Test Set Performance:
  - Test Loss: 0.0231
  - Test Accuracy: 0.9931

(venv) (base) D:\FedXViT>python train.py --num_classes 4 --batch_size 16 --epochs 30
































































































































































































































































































































